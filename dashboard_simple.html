<!DOCTYPE html>
<html>
<head>
    <title>Strategy Miner Dashboard</title>
    <meta charset="UTF-8">
    <style>
        body {
            font-family: 'Segoe UI', sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: white;
            padding: 20px;
            margin: 0;
        }
        h1 {
            text-align: center;
            background: linear-gradient(90deg, #00d4ff, #7c3aed);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            font-size: 2.5em;
        }
        .stats {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 20px;
            margin: 30px 0;
        }
        .stat {
            background: rgba(255,255,255,0.1);
            border-radius: 15px;
            padding: 25px;
            text-align: center;
        }
        .stat-value {
            font-size: 2em;
            font-weight: bold;
        }
        .section {
            background: rgba(255,255,255,0.05);
            border-radius: 15px;
            padding: 20px;
            margin: 20px 0;
        }
        .section h2 {
            margin-top: 0;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }
        table { width: 100%; border-collapse: collapse; }
        th, td {
            padding: 10px;
            text-align: left;
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        th { background: rgba(124, 58, 237, 0.3); }
        .active { background: #10b981; padding: 3px 10px; border-radius: 10px; }
        .inactive { background: rgba(255,255,255,0.2); padding: 3px 10px; border-radius: 10px; }
    </style>
</head>
<body>
    <h1>üß¨ Strategy Miner Dashboard</h1>
    
    <div class="stats">
        <div class="stat">
            <div class="stat-value" id="wu-total">-</div>
            <div>Work Units Total</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="wu-completed">-</div>
            <div>Completados</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="wu-workers">-</div>
            <div>Workers Activos</div>
        </div>
        <div class="stat">
            <div class="stat-value" id="wu-best">$0</div>
            <div>Best PnL</div>
        </div>
    </div>
    
    <div class="section">
        <h2>üèÜ Leaderboard</h2>
        <table id="leaderboard"></table>
    </div>
    
    <div class="section">
        <h2>üìä Workers Activos</h2>
        <table id="workers"></table>
    </div>
    
    <script>
        async function load() {
            try {
                // Status
                let s = await fetch('/api/status').then(r => r.json());
                document.getElementById('wu-total').textContent = s.work_units.total;
                document.getElementById('wu-completed').textContent = s.work_units.completed;
                document.getElementById('wu-workers').textContent = s.workers.active;
                if (s.best_strategy) {
                    document.getElementById('wu-best').textContent = '$' + s.best_strategy.pnl.toFixed(2);
                }
                
                // Leaderboard
                let lb = await fetch('/api/leaderboard').then(r => r.json());
                let lbHtml = '<tr><th>#</th><th>Maquina</th><th>Plataforma</th><th>WUs</th><th>Horas</th><th>Estado</th></tr>';
                lb.leaderboard.slice(0, 10).forEach((w, i) => {
                    lbHtml += '<tr><td>' + (i+1) + '</td><td>' + w.friendly_name + '</td><td>' + w.platform + '</td><td><b>' + w.work_units + '</b></td><td>' + w.execution_time_hours + 'h</td><td><span class="' + w.status + '">' + w.status + '</span></td></tr>';
                });
                document.getElementById('leaderboard').innerHTML = lbHtml;
                
                // Workers
                let ws = await fetch('/api/workers').then(r => r.json());
                let wsHtml = '<tr><th>Maquina</th><th>Plataforma</th><th>WUs</th><th>Minutos</th><th>Estado</th></tr>';
                ws.workers.filter(w => w.status === 'active').forEach(w => {
                    wsHtml += '<tr><td>' + w.friendly_name + '</td><td>' + w.platform + '</td><td>' + w.work_units_completed + '</td><td>' + w.last_seen_minutes_ago.toFixed(0) + ' min</td><td><span class="active">Activo</span></td></tr>';
                });
                document.getElementById('workers').innerHTML = wsHtml;
                
            } catch(e) {
                console.error('Error:', e);
            }
        }
        
        load();
        setInterval(load, 30000);
    </script>
</body>
</html>

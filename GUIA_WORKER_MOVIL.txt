â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ğŸ“± GUÃA COMPLETA: WORKER MÃ“VIL (MacBook Air)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VERSIÃ“N: Worker Installer v2.6 (Mobile Edition)
FECHA: 2026-01-26

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ¯ Â¿QUÃ‰ ES UN WORKER MÃ“VIL?
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Un Worker MÃ³vil es un nodo Ray configurado para:
  â€¢ Tolerar cambios de red (WiFi â†’ Celular â†’ WiFi)
  â€¢ Reconectarse automÃ¡ticamente al Head cuando regresa la conexiÃ³n
  â€¢ Operar en laptops que se mueven (MacBook Air)
  â€¢ NO crashear el Head cuando se desconecta
  â€¢ Continuar trabajando aunque pierda conexiÃ³n temporalmente

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ—ï¸ ARQUITECTURA WORKER MÃ“VIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

COMPONENTES:

1. DAEMON (worker_daemon.sh)
   â€¢ Corre en background 24/7
   â€¢ Monitorea conexiÃ³n con Head cada 30 segundos
   â€¢ Detecta desconexiones
   â€¢ Reinicia Ray Worker automÃ¡ticamente
   â€¢ Logs en ~/.bittrader_worker/worker.log

2. LAUNCHD SERVICE
   â€¢ Inicia daemon al arrancar macOS
   â€¢ Reinicia daemon si falla
   â€¢ Gestiona el ciclo de vida del Worker

3. HEALTH CHECK
   â€¢ Verifica ping al Head cada 30 segundos
   â€¢ Si no hay ping â†’ intenta reconectar Tailscale
   â€¢ Si Tailscale OK â†’ intenta reconectar Ray
   â€¢ Loop infinito de reconexiÃ³n

4. TAILSCALE VPN
   â€¢ ConexiÃ³n segura al Head remoto
   â€¢ Funciona en cualquier red (WiFi, Celular)
   â€¢ IP estable incluso al cambiar de red

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”„ CICLO DE VIDA DEL WORKER MÃ“VIL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESTADO 1: CONECTADO (En casa, WiFi estable)
  âœ… Worker conectado al Head
  âœ… 22 CPUs disponibles (12 Head + 10 Worker)
  âœ… Ray corriendo normalmente
  âœ… Daemon verifica cada 30s que todo estÃ© bien

ESTADO 2: DESCONECTANDO (Saliendo de casa)
  âš ï¸ WiFi se pierde
  âš ï¸ Daemon detecta: ping al Head falla
  âš ï¸ Daemon intenta reconectar (30s)
  âš ï¸ Si no puede, detiene Ray Worker limpiamente
  â„¹ï¸  Head continÃºa con 12 CPUs (sin crashes)

ESTADO 3: DESCONECTADO (Fuera de casa, sin WiFi)
  âŒ Worker desconectado
  âŒ Head continÃºa solo con 12 CPUs
  ğŸ”„ Daemon sigue intentando reconectar cada 30s
  â„¹ï¸  No afecta al Head

ESTADO 4: RECONECTANDO (Regresando a casa, WiFi regresa)
  ğŸ”„ WiFi detectado
  ğŸ”„ Tailscale se reconecta
  ğŸ”„ Daemon detecta: ping al Head exitoso
  ğŸ”„ Daemon inicia Ray Worker
  âœ… Worker reconectado

ESTADO 5: RECONECTADO
  âœ… Worker conectado nuevamente
  âœ… 22 CPUs disponibles otra vez
  âœ… Ray retoma trabajos
  âœ… Daemon vuelve a verificar cada 30s

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“Š LOGS Y MONITOREO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

VER LOGS EN TIEMPO REAL:
  tail -f ~/.bittrader_worker/worker.log

LOGS TÃPICOS - CONECTADO:
  2026-01-26 10:00:00 - ğŸš€ Worker Daemon iniciado
  2026-01-26 10:00:00 - ğŸ“± Worker MÃ³vil Detectado (MacBookAir10,1)
  2026-01-26 10:00:00 -    Modo de reconexiÃ³n resiliente activado
  2026-01-26 10:00:00 -    Head Node: 100.x.x.x
  2026-01-26 10:00:00 -    Retry Delay: 30s
  2026-01-26 10:00:05 - ğŸ”— Conectando a 100.x.x.x:6379...
  2026-01-26 10:00:08 - âœ… Worker MÃ³vil conectado al cluster con 10 CPUs
  2026-01-26 10:00:08 -    (ReconexiÃ³n automÃ¡tica si se pierde la red)

LOGS TÃPICOS - DESCONEXIÃ“N:
  2026-01-26 12:30:45 - âš ï¸ No puedo contactar al Head (100.x.x.x).
  2026-01-26 12:30:45 - â„¹ï¸ Tailscale conectado (...), pero ping fallÃ³.
  2026-01-26 12:31:15 - âš ï¸ No puedo contactar al Head (100.x.x.x).
  2026-01-26 12:31:45 - âš ï¸ Ray corriendo pero sin conexiÃ³n al Head. Reiniciando...

LOGS TÃPICOS - RECONEXIÃ“N:
  2026-01-26 15:20:10 - ğŸ”— Conectando a 100.x.x.x:6379...
  2026-01-26 15:20:13 - âœ… Worker MÃ³vil conectado al cluster con 10 CPUs
  2026-01-26 15:20:13 -    (ReconexiÃ³n automÃ¡tica si se pierde la red)

VER ESTADO DE RAY:
  .venv/bin/ray status

VER PROCESOS DE RAY:
  ps aux | grep ray

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ® USO PRÃCTICO - ESCENARIOS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

ESCENARIO 1: TRABAJAR EN CASA CON MÃXIMO RENDIMIENTO
------------------------------------------------------

1. Asegurar que MacBook Pro (Head) estÃ¡ corriendo:
   â€¢ En MacBook Pro: ray status â†’ Debe mostrar Head activo

2. Asegurar que Worker estÃ¡ conectado:
   â€¢ En MacBook Air: tail ~/.bittrader_worker/worker.log
   â€¢ Debe mostrar: "âœ… Worker MÃ³vil conectado"

3. Ejecutar Strategy Miner:
   â€¢ En MacBook Pro (o Air vÃ­a SSH):
     python strategy_miner.py
   â€¢ UsarÃ¡ 22 CPUs

4. Resultado:
   â€¢ MÃ¡xima velocidad
   â€¢ ~30% mÃ¡s rÃ¡pido que solo Head


ESCENARIO 2: LLEVAR MACBOOK AIR A TRABAJAR FUERA
--------------------------------------------------

1. ANTES de salir:
   â€¢ Worker estÃ¡ conectado (22 CPUs)
   â€¢ Strategy Miner corriendo

2. DURANTE el viaje:
   â€¢ WiFi se pierde
   â€¢ Worker se desconecta (logs: "No puedo contactar al Head")
   â€¢ Head continÃºa con 12 CPUs
   â€¢ Strategy Miner continÃºa (mÃ¡s lento pero sin fallar)

3. AL LLEGAR a otro lugar con WiFi:
   â€¢ WiFi se conecta
   â€¢ Worker se reconecta automÃ¡ticamente (logs: "Worker MÃ³vil conectado")
   â€¢ Head retoma 22 CPUs
   â€¢ Strategy Miner se acelera

4. Resultado:
   â€¢ Trabajo continÃºa sin intervenciÃ³n
   â€¢ No se pierde progreso


ESCENARIO 3: SOLO USAR MACBOOK PRO (HEAD) MIENTRAS ESTÃS FUERA
----------------------------------------------------------------

1. MacBook Air desconectado (lo llevas fuera)

2. En MacBook Pro (remoto via SSH):
   ssh usuario@macbook-pro
   cd "/path/to/proyecto"
   .venv/bin/python strategy_miner.py

3. Ray usa solo 12 CPUs del Head

4. Resultado:
   â€¢ Trabajo continÃºa con rendimiento reducido
   â€¢ Cuando regreses y conectes Air, recuperarÃ¡ 22 CPUs


ESCENARIO 4: USAR MACBOOK AIR PARA TRABAJAR MIENTRAS HEAD CORRE
-----------------------------------------------------------------

1. Head corriendo en MacBook Pro

2. Worker en MacBook Air desconectado (opcional)

3. Usar MacBook Air para otras tareas:
   â€¢ Navegar web
   â€¢ Editar cÃ³digo
   â€¢ Ver resultados via Streamlit en Head

4. Resultado:
   â€¢ MacBook Air libre para trabajar
   â€¢ Head corre optimizaciones en background

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
âš™ï¸ CONFIGURACIÃ“N Y MANTENIMIENTO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

REINICIAR WORKER DAEMON:
  launchctl unload ~/Library/LaunchAgents/com.bittrader.worker.plist
  launchctl load ~/Library/LaunchAgents/com.bittrader.worker.plist

DETENER WORKER PERMANENTEMENTE:
  launchctl unload ~/Library/LaunchAgents/com.bittrader.worker.plist
  .venv/bin/ray stop

INICIAR WORKER MANUALMENTE:
  cd ~/.bittrader_worker
  ./worker_daemon.sh

CAMBIAR HEAD_IP (Si MacBook Pro cambiÃ³ de IP):
  nano ~/.bittrader_worker/config.env
  # Cambiar HEAD_IP=100.x.x.x
  # Reiniciar daemon

CAMBIAR NÃšMERO DE CPUS:
  echo "8" > ~/.bittrader_worker/current_cpus
  # Reiniciar daemon
  # UsarÃ¡ 8 CPUs en vez de 10 (para dejar mÃ¡s libres)

VER CONFIGURACIÃ“N ACTUAL:
  cat ~/.bittrader_worker/config.env

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ”§ TROUBLESHOOTING
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

PROBLEMA: Worker no se reconecta despuÃ©s de perder WiFi
SOLUCIÃ“N:
  1. Verificar Tailscale:
     tailscale status

  2. Verificar logs:
     tail -50 ~/.bittrader_worker/worker.log

  3. Verificar ping al Head:
     ping <HEAD_IP>

  4. Reiniciar daemon:
     launchctl unload ~/Library/LaunchAgents/com.bittrader.worker.plist
     launchctl load ~/Library/LaunchAgents/com.bittrader.worker.plist

PROBLEMA: Logs muestran "Error conectando" continuamente
SOLUCIÃ“N:
  â€¢ Verificar que Head estÃ¡ corriendo:
    ssh <HEAD_IP>
    ray status

  â€¢ Verificar firewall en Head no bloquea puerto 6379

  â€¢ Verificar Tailscale estÃ¡ conectado en ambos:
    tailscale status

PROBLEMA: Worker se conecta pero no aparece en ray status del Head
SOLUCIÃ“N:
  1. En Head, verificar:
     ray status

  2. Verificar Python version coincide:
     python --version  # Debe ser 3.9.6 en ambos

  3. Verificar Ray version coincide:
     ray --version  # Debe ser 2.51.2 en ambos

  4. Reiniciar Worker:
     ray stop
     # Daemon lo reiniciarÃ¡ automÃ¡ticamente

PROBLEMA: Daemon crashea y no se reinicia
SOLUCIÃ“N:
  1. Verificar launchd:
     launchctl list | grep bittrader

  2. Ver logs de launchd:
     cat /tmp/bittrader_worker.log

  3. Reinstalar daemon:
     cd Worker_Installer_Package
     ./install.sh

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ’¡ TIPS Y MEJORES PRÃCTICAS
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

1. MONITOREAR LOGS AL MOVERTE
   â€¢ Antes de salir de casa:
     tail -f ~/.bittrader_worker/worker.log
   â€¢ Verifica que se desconecta limpiamente
   â€¢ Al llegar, verifica que se reconecta

2. USAR SSH PARA ACCESO REMOTO
   â€¢ En MacBook Air:
     ssh <HEAD_IP>
   â€¢ Puedes monitorear Head mientras estÃ¡s fuera

3. NO CERRAR MACBOOK AIR AL MOVERSE
   â€¢ Si cierras la tapa, WiFi se apaga
   â€¢ Worker no se reconectarÃ¡ hasta que abras la tapa
   â€¢ Mejor: dejar abierto o configurar "No dormir con tapa cerrada"

4. VERIFICAR BATERÃA EN WORKER MÃ“VIL
   â€¢ Ray consume CPU â†’ baterÃ­a se agota rÃ¡pido
   â€¢ Si baterÃ­a baja, Worker se apagarÃ¡
   â€¢ Mejor: conectar a corriente cuando trabajes

5. USAR STRATEGY MINER EN HEAD, NO EN WORKER
   â€¢ Ejecuta scripts en MacBook Pro (Head)
   â€¢ Worker solo contribuye CPUs
   â€¢ MÃ¡s confiable si Worker se desconecta

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ˆ RENDIMIENTO WORKER MÃ“VIL vs FIJO
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

WORKER MÃ“VIL (MacBook Air):
  âœ… ReconexiÃ³n automÃ¡tica
  âœ… Tolera desconexiones
  âš ï¸ Latencia variable (depende de red)
  âš ï¸ Puede desconectarse durante trabajos

WORKER FIJO (Si tuvieras otro Mac en casa):
  âœ… ConexiÃ³n estable 24/7
  âœ… Latencia mÃ­nima
  âŒ No portÃ¡til

RECOMENDACIÃ“N:
  â€¢ Para trabajos largos (>1 hora): Usar ambos
  â€¢ Para trabajos cortos (<30 min): Solo Head si estÃ¡s fuera
  â€¢ Para mÃ¡ximo rendimiento: Ambos en casa con WiFi

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
ğŸ“ ENTENDER EL CÃ“DIGO - WORKER DAEMON
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

DETECCIÃ“N DE MODO MÃ“VIL (worker_daemon.sh lÃ­nea 30):
  DEVICE_MODEL=$(sysctl -n hw.model)
  if [[ "$DEVICE_MODEL" == *"MacBookAir"* ]]; then
      MOBILE_MODE=true
      RETRY_DELAY=30  # ReconexiÃ³n cada 30s
  else
      MOBILE_MODE=false
      RETRY_DELAY=60  # ReconexiÃ³n cada 60s
  fi

HEALTH CHECK (worker_daemon.sh lÃ­nea 83):
  # Verifica si Ray estÃ¡ conectado
  if pgrep -x "raylet" > /dev/null; then
      # Ray corriendo, verificar conexiÃ³n
      if python -c "import ray; ray.init(...)"; then
          # OK, esperar 30s y verificar otra vez
      else
          # No conectado, reiniciar
          ray stop
      fi
  fi

RECONEXIÃ“N (worker_daemon.sh lÃ­nea 146):
  # Intenta conectar
  ray start --address="$HEAD_IP:6379" --num-cpus="$CPUS"

  # Si falla, espera RETRY_DELAY y reintenta
  sleep $RETRY_DELAY

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

FECHA: 2026-01-26
VERSIÃ“N: Worker Installer v2.6 (Mobile Edition)
ESTADO: âœ… GUÃA COMPLETA Y LISTA PARA USO

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
